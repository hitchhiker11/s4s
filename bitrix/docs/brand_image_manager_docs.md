# Brand Image Manager API

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä `BrandImageManager` –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –±—Ä–µ–Ω–¥–æ–≤ –∏–∑ base64 –¥–∞–Ω–Ω—ã—Ö. –°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–º–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ –±—Ä–µ–Ω–¥–æ–≤ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–≤—è–∑—ã–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏.

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–£–º–Ω—ã–π –ø–æ–∏—Å–∫ –±—Ä–µ–Ω–¥–æ–≤** - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏–π
- **Base64 –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **–ì–∏–±–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - –ø–æ—Ä–æ–≥ —Å—Ö–æ–∂–µ—Å—Ç–∏, —Ä–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤, –∫–∞—á–µ—Å—Ç–≤–æ
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤, —Ä–∞–∑–º–µ—Ä–æ–≤, –∑–∞—â–∏—Ç–∞ –æ—Ç –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω–æ–≥–æ –∫–æ–¥–∞
- **–ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –æ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
- **–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∏—Å–∫–∞ –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

## üîå Endpoint

```
POST /api/brand-images
```

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

```bash
Authorization-Token: your-jwt-token
```

## üìù –§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞

### Headers
```
Content-Type: application/json
Authorization-Token: your-jwt-token
```

### Request Body
```json
{
  "brands": [
    {
      "name": "GLOCK",
      "image": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAI..."
    },
    {
      "name": "Beretta",
      "image": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD..."
    }
  ]
}
```

### Query Parameters

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|--------------|----------|
| `brands_iblock_id` | integer | 22 | ID –∏–Ω—Ñ–æ–±–ª–æ–∫–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –±—Ä–µ–Ω–¥–æ–≤ |
| `similarity_threshold` | float | 0.8 | –ü–æ—Ä–æ–≥ —Å—Ö–æ–∂–µ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–π (0.1-1.0) |
| `max_brands_per_request` | integer | 100 | –ú–∞–∫—Å. –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–µ–Ω–¥–æ–≤ –≤ –∑–∞–ø—Ä–æ—Å–µ |
| `max_image_size` | integer | 5242880 | –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –±–∞–π—Ç–∞—Ö |
| `image_quality` | integer | 85 | –ö–∞—á–µ—Å—Ç–≤–æ —Å–∂–∞—Ç–∏—è (10-100) |
| `dry_run` | string | N | –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (Y/N) |
| `overwrite_existing` | string | N | –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ (Y/N) |
| `with_logging` | string | Y | –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (Y/N) |

## üß† –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞ –±—Ä–µ–Ω–¥–æ–≤

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ—Å—Ç—É–ø–µ–Ω—á–∞—Ç—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–∏—Å–∫–∞:

### 1. –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
```
Input: "GLOCK" ‚Üí Found: "GLOCK" (similarity: 1.0)
```

### 2. –†–µ–≥–∏—Å—Ç—Ä–æ–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
```
Input: "glock" ‚Üí Found: "GLOCK" (similarity: 1.0)
```

### 3. –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
```
Input: "G L O C K" ‚Üí Found: "GLOCK" (similarity: 1.0)
```

### 4. –í—Ö–æ–∂–¥–µ–Ω–∏–µ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏
```
Input: "Glock" ‚Üí Found: "Glock Inc." (similarity: 0.85)
```

### 5. –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –õ–µ–≤–µ–Ω—à—Ç–µ–π–Ω–∞
```
Input: "Glok" ‚Üí Found: "GLOCK" (similarity: 0.75)
```

## üìä –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞

### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (200)
```json
{
  "status": "success",
  "meta": {
    "brands_iblock_id": 22,
    "processed_count": 5,
    "successful_count": 3,
    "failed_count": 2,
    "similarity_threshold": 0.8,
    "dry_run": false,
    "execution_time": 2.45,
    "timestamp": "2025-01-15 15:30:00"
  },
  "results": {
    "successful": [
      {
        "input_name": "GLOCK",
        "found_brand": {
          "id": 8340,
          "name": "GLOCK",
          "code": "glock"
        },
        "match_type": "exact",
        "similarity": 1.0,
        "image_updated": true,
        "old_image_id": 123,
        "new_image_id": 456,
        "file_size": 15420
      }
    ],
    "failed": [
      {
        "input_name": "Unknown Brand",
        "reason": "brand_not_found",
        "attempted_matches": ["GLOCK", "Apple"],
        "best_similarity": 0.2
      }
    ]
  },
  "debug_log": [
    {
      "timestamp": "15:30:01",
      "message": "–û–±—Ä–∞–±–æ—Ç–∫–∞ –±—Ä–µ–Ω–¥–∞ GLOCK",
      "data": {"similarity": 1.0, "match_type": "exact"}
    }
  ]
}
```

## üö® –ö–æ–¥—ã –æ—à–∏–±–æ–∫

### 400 Bad Request
```json
{"error": "Empty brands array"}
{"error": "Brand #0: missing or empty 'name' field"}
{"error": "Brand #0: invalid base64 image format"}
{"error": "Brand #0: unsupported image format 'image/gif'"}
{"error": "Brand #0: image size (7.2MB) exceeds maximum allowed (5.0MB)"}
```

### 404 Not Found
```json
{"error": "Brands iblock not found or inactive"}
```

### 500 Internal Server Error
```json
{"error": "Failed to process image: invalid file format"}
```

## üìà –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ë–∞–∑–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
```bash
curl -X POST "https://shop4shoot.com/api/brand-images" \
  -H "Authorization-Token: jwt-token" \
  -H "Content-Type: application/json" \
  -d '{
    "brands": [
      {
        "name": "GLOCK",
        "image": "data:image/png;base64,iVBORw0KGgoAAAA..."
      }
    ]
  }'
```

### 2. –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º
```bash
curl -X POST "https://shop4shoot.com/api/brand-images?dry_run=Y" \
  -H "Authorization-Token: jwt-token" \
  -H "Content-Type: application/json" \
  -d '{
    "brands": [
      {"name": "glock", "image": "data:image/png;base64,test..."}
    ]
  }'
```

### 3. –ù–µ—á–µ—Ç–∫–∏–π –ø–æ–∏—Å–∫ —Å –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å—é
```bash
curl -X POST "https://shop4shoot.com/api/brand-images?similarity_threshold=0.6&overwrite_existing=Y" \
  -H "Authorization-Token: jwt-token" \
  -H "Content-Type: application/json" \
  -d '{
    "brands": [
      {
        "name": "Glock Inc",
        "image": "data:image/webp;base64,UklGRiQAA..."
      }
    ]
  }'
```

## üé® –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

- **JPEG** (`image/jpeg`) - —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
- **PNG** (`image/png`) - —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏
- **WebP** (`image/webp`) - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–∂–∞—Ç—ã–π —Ñ–æ—Ä–º–∞—Ç

## üìè –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ |
|----------|-------------|
| –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è | 20MB |
| –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–µ–Ω–¥–æ–≤ | 500 –∑–∞ –∑–∞–ø—Ä–æ—Å |
| –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ —Å—Ö–æ–∂–µ—Å—Ç–∏ | 0.1 |
| –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã | JPEG, PNG, WebP |

## üîç –¢–∏–ø—ã —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π

| –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|-----|----------|--------|
| `exact` | –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ | "GLOCK" ‚Üí "GLOCK" |
| `exact_normalized` | –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ | "G L O C K" ‚Üí "GLOCK" |
| `contains_input` | –ö–∞—Ç–∞–ª–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–≤–æ–¥ | "Glock" ‚Üí "Glock Inc." |
| `input_contains` | –í–≤–æ–¥ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–∞—Ç–∞–ª–æ–≥ | "Glock Corporation" ‚Üí "Glock" |
| `levenshtein` | –ü–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é –õ–µ–≤–µ–Ω—à—Ç–µ–π–Ω–∞ | "Glok" ‚Üí "GLOCK" |

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–∞–º–∏

1. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤** - —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ MIME —Ç–∏–ø—ã
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤
3. **–î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ base64** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
4. **–ë–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤** - –ø—Ä—è–º–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ø–æ—Ç–æ–∫–∞–º–∏ –≤ –ø–∞–º—è—Ç–∏
5. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ fallback –º–µ—Ç–æ–¥—ã** - –æ–±—Ö–æ–¥ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–æ–≤
6. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π** - –∞—É–¥–∏—Ç –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π

### –ú–µ—Ç–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:
**–í—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª + CFile::MakeFileArray** (–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± —Å —Ñ–æ—Ä—É–º–∞ –ë–∏—Ç—Ä–∏–∫—Å)
- –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ base64 —á–µ—Ä–µ–∑ `preg_replace` + `base64_decode`
- –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ `file_put_contents`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `CFile::MakeFileArray` –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Å—Å–∏–≤–∞ —Ñ–∞–π–ª–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –≤ —Ñ–∞–π–ª–∞—Ö:
- `/local/logs/brand_image_manager.log` - —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- `/local/logs/brand_image_manager_errors.log` - –æ—à–∏–±–∫–∏

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π

–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ—Ç –∂–µ –∏–Ω—Ñ–æ–±–ª–æ–∫ –±—Ä–µ–Ω–¥–æ–≤ (ID: 22), —á—Ç–æ –∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `BrandManager`, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –ø–æ–ª–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å:
- –ö–∞—Ç–∞–ª–æ–≥–æ–º —Ç–æ–≤–∞—Ä–æ–≤
- –°–∏—Å—Ç–µ–º–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –±—Ä–µ–Ω–¥–∞–º
- API –ø–æ–ª—É—á–µ–Ω–∏—è –±—Ä–µ–Ω–¥–æ–≤
- –ú–µ—Ö–∞–Ω–∏–∑–º–æ–º —Å–≤—è–∑—ã–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

1. **–ù–∞—á–Ω–∏—Ç–µ —Å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–∏—Å–∫–∞ –±—Ä–µ–Ω–¥–æ–≤
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞–∫–µ—Ç–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É** –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ—Ä–æ–≥ —Å—Ö–æ–∂–µ—Å—Ç–∏** –ø–æ–¥ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ (0.6-0.9)
4. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** –¥–ª—è –≤—ã—è–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º
5. **–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π

## üîß –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ë—Ä–µ–Ω–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ—á–Ω–æ—Å—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è
- –£–º–µ–Ω—å—à–∏—Ç–µ `similarity_threshold`
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `dry_run=Y` –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç base64
- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫–µ MIME —Ç–∏–ø–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞
- –£–º–µ–Ω—å—à–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–µ–Ω–¥–æ–≤ –∑–∞ –∑–∞–ø—Ä–æ—Å
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ —Ä–∞–∑–º–µ—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ WebP —Ñ–æ—Ä–º–∞—Ç

### –ü—Ä–æ–±–ª–µ–º—ã —Å –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–∞–º–∏
–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–æ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:

**–ü—Ä–æ—Å—Ç–æ–π –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º:**

```php
// 1. –î–µ–∫–æ–¥–∏—Ä—É–µ–º base64
$data = base64_decode(preg_replace('#^data:image/\w+;base64,#i', '', $base64Image));

// 2. –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª  
file_put_contents($tempFilePath, $data);

// 3. –ò—Å–ø–æ–ª—å–∑—É–µ–º CFile::MakeFileArray
$arFile = CFile::MakeFileArray($tempFilePath);

// 4. –û–±–Ω–æ–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç
$el->Update($brandId, ['PREVIEW_PICTURE' => $arFile]);

// 5. –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
unlink($tempFilePath);
```

–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –≤–∑—è—Ç —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä—É–º–∞ –ë–∏—Ç—Ä–∏–∫—Å –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.

**–õ–æ–≥–∏ –ø–æ–∫–∞–∂—É—Ç —Å—Ç–∞—Ç—É—Å –æ–ø–µ—Ä–∞—Ü–∏–∏:**
- `method: temporary_file_forum_method` - —É—Å–ø–µ—à–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏ —É–¥–∞–ª–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
- –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –∏ –ø—É—Ç—å –∫ –≤—Ä–µ–º–µ–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É

–ï—Å–ª–∏ –≤—Å–µ –º–µ—Ç–æ–¥—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–∞ –∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç–µ real-time –∑–∞—â–∏—Ç—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. 