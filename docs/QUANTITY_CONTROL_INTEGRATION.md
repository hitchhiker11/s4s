# Интеграция системы управления корзиной в ProductCard

## Обзор

Реализована новая система управления корзиной, которая автоматически переключает отображение в карточках товаров (`ProductCard`) между кнопкой "В корзину" и контролом количества в зависимости от состояния товара в корзине.

## Принцип работы

### До добавления в корзину
- Отображается кнопка "В корзину" / "Предзаказ"
- При нажатии товар добавляется в корзину
- Показывается тост-уведомление об успешном добавлении

### После добавления в корзину
- Кнопка "В корзину" заменяется на `QuantityControl`
- Пользователь может изменять количество товара
- При количестве = 1 кнопка "-" заменяется на иконку удаления
- При нажатии на иконку удаления товар удаляется из корзины

## Компоненты системы

### 1. QuantityControl
**Путь:** `frontend/src/components/QuantityControl/`

Переиспользуемый компонент для управления количеством товаров.

**Пропы:**
- `quantity` - текущее количество
- `onQuantityChange` - callback для изменения количества
- `onRemove` - callback для удаления товара
- `isLoading` - состояние загрузки
- `showRemoveOnOne` - показывать ли иконку удаления при количестве = 1
- `size` - размер компонента ('default', 'compact', 'small')
- `orientation` - ориентация ('horizontal', 'vertical')
- `className` - дополнительные CSS классы
- `disabled` - отключенное состояние

### 2. ProductCard (обновленный)
**Путь:** `frontend/src/components/ProductCard.js`

Теперь автоматически определяет, находится ли товар в корзине, и отображает соответствующий контрол.

**Изменения:**
- Удален проп `onAddToCart` - обработка теперь внутренняя
- Добавлена проверка наличия товара в корзине
- Условное отображение кнопки или `QuantityControl`
- Интеграция с `useBasket` hook

### 3. CartItem (обновленный)
**Путь:** `frontend/src/components/CartItem/`

Теперь использует переиспользуемый `QuantityControl` вместо собственной реализации.

## Страницы с интеграцией

Система работает на всех страницах, где используется `ProductCard`:

### 1. Главная страница
**Путь:** `frontend/src/pages/index.js`
- Секция "Новые поступления"
- Секция "Хиты продаж"
- Секция "Наши бренды"

### 2. Страница категории
**Путь:** `frontend/src/pages/catalog/[categoryCode]/index.js`
- Отображение подкатегорий

### 3. Страница всех товаров категории
**Путь:** `frontend/src/pages/catalog/[categoryCode]/all.js`
- Список всех товаров категории с пагинацией

### 4. Страница подкатегории
**Путь:** `frontend/src/pages/catalog/[categoryCode]/[subCategoryCode]/index.js`
- Товары подкатегории

### 5. Страница товара
**Путь:** `frontend/src/pages/catalog/[categoryCode]/[subCategoryCode]/[productID].js`
- Рекомендуемые товары

### 6. Страница корзины
**Путь:** `frontend/src/pages/cart.js`
- Секция "Рекомендуемые товары"
- Основные товары корзины используют `QuantityControl`

## Компоненты-контейнеры (обновленные)

### ResponsiveProductSection
Убраны пропы `onAddToCart` - система теперь автономна.

### ProductSlider
Убраны пропы `onAddToCart` - `ProductCard` обрабатывает добавление внутренне.

### ProductGrid
Убраны пропы `onAddToCart` - `ProductCard` обрабатывает добавление внутренне.

## Технические детали

### useBasket Hook Integration
`ProductCard` использует `useBasket` hook для:
- Получения текущего состояния корзины
- Проверки наличия товара в корзине
- Добавления товаров в корзину
- Обновления количества товаров
- Удаления товаров из корзины

### Стили
- `QuantityControl` имеет адаптивные стили для разных размеров
- Специальные стили `.productCardStyle` для интеграции с `ProductCard`
- Мобильная адаптация с различными размерами на разных устройствах

### Состояния Loading
- Во время операций с корзиной показываются спиннеры
- Кнопки отключаются для предотвращения множественных запросов
- Плавные переходы между состояниями

## Преимущества новой системы

1. **Единообразие UX** - одинаковое поведение на всех страницах
2. **Переиспользуемость** - `QuantityControl` используется в `ProductCard` и `CartItem`
3. **Автономность** - `ProductCard` не требует внешних обработчиков
4. **Реактивность** - мгновенное отображение изменений состояния корзины
5. **Accessibility** - правильные ARIA-метки и состояния disabled

## Миграция

При обновлении существующих компонентов:

1. Убрать пропы `onAddToCart` из компонентов, использующих `ProductCard`
2. `ProductCard` теперь полностью автономен
3. Использовать `QuantityControl` для новых компонентов, требующих управления количеством

## Структура файлов

```
frontend/src/components/
├── QuantityControl/
│   ├── index.js
│   └── QuantityControl.module.css
├── ProductCard.js (обновлен)
└── CartItem/
    ├── index.js (обновлен)
    └── CartItem.module.css (очищен)
``` 